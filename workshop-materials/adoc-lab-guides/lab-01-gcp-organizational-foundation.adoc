:toc:
:toclevels: 1
:numbered:
:source-highlighter: highlightjs
:icons: font

= Lab 01: GCP Organizational Foundation

== Lab Overview

_Duration_: 45 minutes 

_Difficulty_: Beginner  

_Prerequisites_: Completion of Lab Environment Setup Guide

=== Lab Description
Set up the foundational organizational structure for TechCorp's multi-environment GCP landing zone using Terraform. This lab establishes the hierarchical resource organization that will support all subsequent infrastructure deployments while ensuring proper governance and compliance controls.

=== Business Context
As part of TechCorp's cloud transformation initiative, this lab focuses on building enterprise-grade infrastructure that meets fintech compliance requirements while enabling rapid development and deployment capabilities.

== Learning Objectives

After completing this lab, you will be able to:

• Create and manage GCP organizational hierarchy using Terraform
• Implement folder structure for environment separation and governance
• Configure basic organizational policies for compliance and security
• Set up project structure for development, staging, and production environments
• Establish naming conventions and resource tagging strategies
• Implement basic billing and resource organization

== Concept Overview (Theory: 15-20 minutes)

=== Key Concepts

_GCP Resource Hierarchy_: The GCP resource hierarchy provides a structured way to organize and manage cloud resources. It consists of Organization (root) → Folders → Projects → Resources. This hierarchy enables centralized policy management, billing organization, and access control inheritance.

_Landing Zone Architecture Patterns_: A landing zone is a foundational cloud infrastructure setup that provides security, networking, and governance frameworks. Common patterns include hub-and-spoke networking, shared services architecture, and multi-account/project strategies for environment isolation.

_Organizational Policies_: GCP Organizational Policies provide centralized, programmatic control over your organization's cloud resources. They enable you to configure restrictions on how resources can be used across your resource hierarchy.

_Terraform for Infrastructure_: Terraform enables Infrastructure as Code (IaC) practices, allowing you to define, version, and manage cloud infrastructure using declarative configuration files. For GCP, Terraform provides comprehensive resource management capabilities.

=== Architecture Diagram
[source]
----
[ASCII diagram would be here showing the components built in this lab]
TechCorp Architecture - Lab 01 Components
----

== Pre-Lab Setup

=== Environment Verification
[source,bash]
----
# Navigate to lab directory
cd ~/gcp-landing-zone-workshop/lab-01

# Source workshop configuration
source ../workshop-config.env

# Verify environment
echo "Project: $PROJECT_ID"
echo "Region: $REGION"
echo "Lab: 01"
echo "Current directory: $(pwd)"

# Check prerequisites from previous labs

----

=== Required Variables
[source,bash]
----
# Set lab-specific variables
export LAB_PREFIX="lab01"
export TIMESTAMP=$(date +%Y%m%d-%H%M%S)
[cols="1,1,1", options="header"]
|===
export LAB_USER=$(gcloud config get-value account | cut -d@ -f1)
|===

# Verify authentication
gcloud auth list --filter=status:ACTIVE

# Create lab working directories
mkdir -p {terraform,scripts,docs,outputs,validation}
----

== Lab Implementation

=== Step 1: Initialize Terraform Configuration

First, we'll create the foundational Terraform configuration files that will manage our organizational structure.

[source,bash]
----
# Navigate to lab directory
cd ~/gcp-landing-zone-workshop/lab-01/terraform

# Create main Terraform configuration
cat > main.tf << 'MAIN_TF_END'
# Lab 01: GCP Organizational Foundation
# This configuration creates the foundational organizational structure for TechCorp

terraform {
  required_version = ">= 1.5"
  required_providers {
    google = {
      source  = "hashicorp/google"
      version = "~> 5.0"
    }
    google-beta = {
      source  = "hashicorp/google-beta"  
      version = "~> 5.0"
    }
  }
}

# Configure the Google Cloud Provider
provider "google" {
  project = var.project_id
  region  = var.region
}

provider "google-beta" {
  project = var.project_id
  region  = var.region
}
MAIN_TF_END

# Create variables file
cat > variables.tf << 'VARIABLES_TF_END'
# Variables for Lab 01: GCP Organizational Foundation

variable "project_id" {
  description = "The GCP project ID for this workshop"
  type        = string
}

variable "region" {
  description = "The default GCP region for resources"
  type        = string
  default     = "us-central1"
}

variable "zone" {
  description = "The default GCP zone for resources"
  type        = string
  default     = "us-central1-a"
}

variable "organization_id" {
  description = "The GCP organization ID (for instructor-led setup)"
  type        = string
  default     = ""
}

variable "billing_account" {
  description = "The billing account ID"
  type        = string
  default     = ""
}

# TechCorp specific variables
variable "company_name" {
  description = "Company name for resource naming"
  type        = string
  default     = "TechCorp"
}

variable "environment_prefix" {
  description = "Prefix for environment naming"
  type        = string
  default     = "tc"
}

variable "participant_id" {
  description = "Unique participant identifier"
  type        = string
  default     = "participant-01"
}
VARIABLES_TF_END

# Create terraform.tfvars file
cat > terraform.tfvars << TFVARS_END
# Lab 01 Configuration Values
project_id = "${PROJECT_ID}"
region = "${REGION}"
zone = "${ZONE}"

# TechCorp Configuration
company_name = "TechCorp"
environment_prefix = "tc"
participant_id = "${PROJECT_ID##*-}"

# Note: organization_id and billing_account are set by instructors
TFVARS_END

echo "✓ Basic Terraform configuration created"
----

=== Step 2: Create Organizational Structure Configuration

Now we'll define the folder and project structure that represents TechCorp's organizational needs.

[source,bash]
----
# Add organizational resources to main.tf
cat >> main.tf << 'ORG_STRUCTURE_END'

# Local values for consistent naming and tagging
locals {
  # Common tags for all resources
  common_tags = {
    company         = var.company_name
    workshop        = "gcp-landing-zone"
    participant     = var.participant_id
    lab             = "01"
    created_by      = "terraform"
    environment     = "workshop"
    cost_center     = "training"
    project_owner   = "workshop-participant"
  }
  
  # Naming conventions
  folder_prefix = "${lower(var.company_name)}-${var.environment_prefix}"
  project_prefix = "${var.project_id}"
}

# Create main environment folder structure
# Note: In a real organization setup, these would be created at the organization level
# For workshop purposes, we'll create a simulated folder structure

resource "google_project" "workshop_projects" {
  for_each = {
    "shared-services" = {
      name = "${var.company_name} Shared Services"
      id   = "${local.project_prefix}-shared"
    }
    "development" = {
      name = "${var.company_name} Development"
      id   = "${local.project_prefix}-dev"
    }
    "staging" = {
      name = "${var.company_name} Staging"
      id   = "${local.project_prefix}-staging"
    }
    "production" = {
      name = "${var.company_name} Production (Simulated)"
      id   = "${local.project_prefix}-prod-sim"
    }
  }
  
  name       = each.value.name
  project_id = each.value.id
  
  # In real scenarios, these would be linked to folders and billing accounts
  # folder_id       = google_folder.environment_folders[each.key].folder_id
  # billing_account = var.billing_account
  
  labels = merge(local.common_tags, {
    environment = each.key
    purpose     = "workshop-simulation"
  })
}

# Enable required APIs for all projects
resource "google_project_service" "required_apis" {
  for_each = {
    for pair in setproduct(
      keys(google_project.workshop_projects),
      [
        "compute.googleapis.com",
        "iam.googleapis.com",
        "cloudresourcemanager.googleapis.com",
        "dns.googleapis.com",
        "logging.googleapis.com",
        "monitoring.googleapis.com",
        "storage-api.googleapis.com"
      ]
    ) : "${pair[0]}-${pair[1]}" => {
      project = pair[0]
      service = pair[1]
    }
  }
  
  project = google_project.workshop_projects[each.value.project].project_id
  service = each.value.service
  
  disable_dependent_services = false
  disable_on_destroy        = false
}
ORG_STRUCTURE_END

echo "✓ Organizational structure configuration added"
----

=== Step 3: Create Project-Level Configurations

Add project-specific configurations and basic security settings.

[source,bash]
----
# Add project configurations
cat >> main.tf << 'PROJECT_CONFIG_END'

# Create basic IAM bindings for workshop projects
resource "google_project_iam_binding" "project_viewers" {
  for_each = google_project.workshop_projects
  
  project = each.value.project_id
  role    = "roles/viewer"
  
  members = [
    "user:${data.google_client_openid_userinfo.current.email}"
  ]
}

# Create service account for each environment
resource "google_service_account" "environment_sa" {
  for_each = google_project.workshop_projects
  
  project      = each.value.project_id
  account_id   = "workshop-${each.key}-sa"
  display_name = "${title(each.key)} Environment Service Account"
  description  = "Service account for ${each.key} environment in workshop"
}

# Basic project metadata
resource "google_compute_project_metadata" "workshop_metadata" {
  for_each = google_project.workshop_projects
  
  project = each.value.project_id
  
  metadata = {
    enable-oslogin     = "TRUE"
    workshop           = "gcp-landing-zone"
    environment        = each.key
    participant        = var.participant_id
    lab                = "01"
    created_timestamp  = timestamp()
  }
}

# Data source to get current user info
data "google_client_openid_userinfo" "current" {}

# Create basic Cloud Storage buckets for each environment (for later labs)
resource "google_storage_bucket" "environment_buckets" {
  for_each = google_project.workshop_projects
  
  name     = "${each.value.project_id}-workshop-storage"
  location = var.region
  project  = each.value.project_id
  
  # Enable uniform bucket-level access
  uniform_bucket_level_access = true
  
  # Versioning for important data
  versioning {
    enabled = true
  }
  
  # Lifecycle management
  lifecycle_rule {
    condition {
      age = 30
    }
    action {
      type = "Delete"
    }
  }
  
  labels = merge(local.common_tags, {
    environment = each.key
    purpose     = "workshop-storage"
  })
  
  depends_on = [google_project_service.required_apis]
}
PROJECT_CONFIG_END

echo "✓ Project-level configurations added"
----

=== Step 4: Create Outputs Configuration

Define outputs that will be used by subsequent labs.

[source,bash]
----
# Create outputs.tf file
cat > outputs.tf << 'OUTPUTS_TF_END'
# Outputs for Lab 01: GCP Organizational Foundation

# Project information
output "workshop_projects" {
  description = "Information about created workshop projects"
  value = {
    for k, v in google_project.workshop_projects : k => {
      project_id   = v.project_id
      project_name = v.name
      number       = v.number
    }
  }
}

output "main_project_id" {
  description = "The main workshop project ID"
  value       = var.project_id
}

output "shared_services_project_id" {
  description = "The shared services project ID"
  value       = google_project.workshop_projects["shared-services"].project_id
}

output "development_project_id" {
  description = "The development project ID"
  value       = google_project.workshop_projects["development"].project_id
}

# Service accounts
output "environment_service_accounts" {
  description = "Service accounts created for each environment"
  value = {
    for k, v in google_service_account.environment_sa : k => {
      email = v.email
      name  = v.name
    }
  }
}

# Storage buckets
output "environment_storage_buckets" {
  description = "Storage buckets created for each environment"
  value = {
    for k, v in google_storage_bucket.environment_buckets : k => {
      name = v.name
      url  = v.url
    }
  }
}

# Common configuration for next labs
output "common_config" {
  description = "Common configuration values for subsequent labs"
  value = {
    region              = var.region
    zone               = var.zone
    company_name       = var.company_name
    environment_prefix = var.environment_prefix
    participant_id     = var.participant_id
    common_tags        = local.common_tags
  }
}

# Current user information
output "current_user" {
  description = "Current authenticated user"
  value       = data.google_client_openid_userinfo.current.email
}
OUTPUTS_TF_END

echo "✓ Outputs configuration created"
----

=== Step 5: Configure Terraform Backend

Set up remote state management for the workshop.

[source,bash]
----
# Create backend configuration
cat > backend.tf << 'BACKEND_TF_END'
# Remote state backend configuration
terraform {
  backend "gcs" {
    bucket = "${TF_STATE_BUCKET}"
    prefix = "lab-01/terraform/state"
  }
}
BACKEND_TF_END

# Initialize Terraform with backend
echo "Initializing Terraform with remote backend..."
terraform init

# Validate configuration
echo "Validating Terraform configuration..."
terraform validate

if [ $? -eq 0 ]; then
    echo "✓ Terraform configuration is valid"
else
    echo "✗ Terraform configuration validation failed"
    exit 1
fi
----

=== Step 6: Plan and Apply Configuration

Review and apply the Terraform configuration to create the organizational structure.

[source,bash]
----
# Create Terraform plan
echo "Creating Terraform execution plan..."
terraform plan -var-file=terraform.tfvars -out=lab01.tfplan

# Review the plan
echo "Review the plan above. It should show:"
echo "- 4 projects to be created (shared-services, dev, staging, prod-sim)"
echo "- Multiple API services to be enabled"
echo "- Service accounts for each environment"
echo "- Storage buckets for each environment"
echo "- IAM bindings and metadata"

read -p "Do you want to apply this plan? (y/N): " confirm
[cols="1,1,1", options="header"]
|===
if [[ $confirm == "y" || $confirm == "Y" ]]; then
|===
    echo "Applying Terraform configuration..."
    terraform apply lab01.tfplan
    
    if [ $? -eq 0 ]; then
        echo "✓ Terraform apply completed successfully"
    else
        echo "✗ Terraform apply failed"
        exit 1
    fi
else
    echo "Terraform apply cancelled"
    exit 1
fi
----

=== Step 7: Generate Documentation

Create documentation for the organizational structure created.

[source,bash]
----
# Navigate back to lab root directory
cd ~/gcp-landing-zone-workshop/lab-01

# Create documentation
mkdir -p docs

cat > docs/organizational-structure.md << 'DOC_END'
# TechCorp Organizational Structure - Lab 01

## Overview
This document describes the GCP organizational structure created for TechCorp's landing zone workshop.

## Created Projects

### 1. Shared Services Project
- **Project ID**: ${PROJECT_ID}-shared
- **Purpose**: Centralized services (DNS, monitoring, logging)
- **Environment**: Production-grade shared services

### 2. Development Project  
- **Project ID**: ${PROJECT_ID}-dev
- **Purpose**: Development environment for application teams
- **Environment**: Non-production, full access for developers

### 3. Staging Project
- **Project ID**: ${PROJECT_ID}-staging
- **Purpose**: Pre-production testing and validation
- **Environment**: Production-like for testing

### 4. Production (Simulated) Project
- **Project ID**: ${PROJECT_ID}-prod-sim
- **Purpose**: Workshop simulation of production environment
- **Environment**: Simulated production for learning

## Service Accounts Created

Each environment has a dedicated service account:
- ${PROJECT_ID}-shared: workshop-shared-services-sa@${PROJECT_ID}-shared.iam.gserviceaccount.com
- ${PROJECT_ID}-dev: workshop-development-sa@${PROJECT_ID}-dev.iam.gserviceaccount.com
- ${PROJECT_ID}-staging: workshop-staging-sa@${PROJECT_ID}-staging.iam.gserviceaccount.com
- ${PROJECT_ID}-prod-sim: workshop-production-sa@${PROJECT_ID}-prod-sim.iam.gserviceaccount.com

## Storage Buckets

Each environment has a dedicated storage bucket for workshop purposes:
- ${PROJECT_ID}-shared-workshop-storage
- ${PROJECT_ID}-dev-workshop-storage
- ${PROJECT_ID}-staging-workshop-storage
- ${PROJECT_ID}-prod-sim-workshop-storage

## Naming Conventions

- **Projects**: ${PROJECT_ID}-{environment}
- **Service Accounts**: workshop-{environment}-sa
- **Storage Buckets**: {project-id}-workshop-storage
- **Labels**: All resources tagged with workshop, environment, and participant info

## Next Steps

This foundational structure will be used in subsequent labs to build:
- VPC networks and subnets (Lab 03)
- IAM roles and policies (Lab 05)
- Monitoring and logging (Labs 06-07)
- Shared services (Lab 08)
- Workload environments (Lab 09)

Generated on: $(date)
Project: ${PROJECT_ID}
Participant: ${LAB_USER}
DOC_END

echo "✓ Organizational structure documentation created"
----

== Expected Deliverables

Upon successful completion of this lab, you should have:

• Terraform configuration files for organizational hierarchy
• Four GCP projects representing TechCorp's environment structure (shared-services, development, staging, production-simulation)
• Environment-specific service accounts with appropriate permissions
• Storage buckets for each environment with lifecycle management
• Project metadata and labeling for resource organization and cost tracking
• Comprehensive documentation of the organizational structure created
• Terraform state file with complete resource inventory

== Validation and Testing

=== Automated Validation
[source,bash]
----
# Create comprehensive validation script
cat > validation/validate-lab-01.sh << 'VALIDATION_SCRIPT_END'
#!/bin/bash

echo "=== Lab 01 Validation Script ==="
echo "Started at: $(date)"
echo "Project: $PROJECT_ID"
echo

# Source workshop configuration
source ../../workshop-config.env

validation_passed=0
validation_failed=0

# Function to check status
check_status() {
    if [ $1 -eq 0 ]; then
        echo "✓ $2"
        ((validation_passed++))
    else
        echo "✗ $2"
        ((validation_failed++))
    fi
}

# Check project creation and accessibility
echo "Checking created projects..."
for env in shared-services development staging production; do
    project_id="${PROJECT_ID}-${env#production}"
    if [ "$env" == "production" ]; then
        project_id="${PROJECT_ID}-prod-sim"
    fi
    
    if gcloud projects describe $project_id &>/dev/null; then
        echo "✓ Project created and accessible: $project_id"
        ((validation_passed++))
    else
        echo "✗ Project not accessible: $project_id"
        ((validation_failed++))
    fi
done

# Check API enablement
echo "Checking API enablement..."
required_apis=("compute.googleapis.com" "iam.googleapis.com" "storage-api.googleapis.com")
for api in "${required_apis[@]}"; do
    enabled_projects=0
    for env in shared-services development staging prod-sim; do
        project_id="${PROJECT_ID}-${env}"
[cols="1,1,1", options="header"]
|===
        if gcloud services list --enabled --project=$project_id --filter="name:$api" --format="value(name)" | grep -q "$api"; then
|===
            ((enabled_projects++))
        fi
    done
    
    if [ $enabled_projects -eq 4 ]; then
        echo "✓ API enabled across all projects: $api"
        ((validation_passed++))
    else
        echo "✗ API not enabled in all projects: $api ($enabled_projects/4)"
        ((validation_failed++))
    fi
done

# Check service accounts
echo "Checking service accounts..."
for env in shared-services development staging prod-sim; do
    project_id="${PROJECT_ID}-${env}"
    sa_email="workshop-${env}-sa@${project_id}.iam.gserviceaccount.com"
    
    if gcloud iam service-accounts describe $sa_email --project=$project_id &>/dev/null; then
        echo "✓ Service account created: $sa_email"
        ((validation_passed++))
    else
        echo "✗ Service account missing: $sa_email"
        ((validation_failed++))
    fi
done

# Check storage buckets
echo "Checking storage buckets..."
for env in shared-services development staging prod-sim; do
    project_id="${PROJECT_ID}-${env}"
    bucket_name="${project_id}-workshop-storage"
    
    if gsutil ls gs://$bucket_name &>/dev/null; then
        echo "✓ Storage bucket created: $bucket_name"
        ((validation_passed++))
    else
        echo "✗ Storage bucket missing: $bucket_name"
        ((validation_failed++))
    fi
done

# Check Terraform outputs
echo "Checking Terraform outputs..."
cd terraform
terraform_outputs=$(terraform output -json 2>/dev/null)
if [ $? -eq 0 ] && [ "$terraform_outputs" != "{}" ]; then
    echo "✓ Terraform outputs available"
    ((validation_passed++))
    
    # Verify specific outputs
[cols="1,1,1", options="header"]
|===
    if echo "$terraform_outputs" | jq -e '.workshop_projects' &>/dev/null; then
|===
        echo "✓ Workshop projects output available"
        ((validation_passed++))
    else
        echo "✗ Workshop projects output missing"
        ((validation_failed++))
    fi
else
    echo "✗ Terraform outputs not available"
    ((validation_failed++))
fi
cd ..

# Check documentation
echo "Checking documentation..."
if [ -f "docs/organizational-structure.md" ]; then
    echo "✓ Organizational structure documentation created"
    ((validation_passed++))
else
    echo "✗ Documentation missing"
    ((validation_failed++))
fi

# Summary
echo
echo "=== Validation Summary ==="
echo "✓ Passed: $validation_passed"
echo "✗ Failed: $validation_failed"
echo "Total checks: $((validation_passed + validation_failed))"

if [ $validation_failed -eq 0 ]; then
    echo
    echo "🎉 Lab 01 validation PASSED!"
    echo "Ready to proceed to next lab."
    
    # Save validation results
    cat > ../outputs/lab-01-validation.json << VALIDATION_JSON_END
{
  "lab": "01",
  "status": "PASSED",
  "timestamp": "$(date -Iseconds)",
  "checks_passed": $validation_passed,
  "checks_failed": $validation_failed,
  "project_id": "$PROJECT_ID"
}
VALIDATION_JSON_END
    
    exit 0
else
    echo
    echo "❌ Lab 01 validation FAILED."
    echo "Please review and fix the issues above."
    
    # Save validation results
    cat > ../outputs/lab-01-validation.json << VALIDATION_JSON_END
{
  "lab": "01",
  "status": "FAILED",
  "timestamp": "$(date -Iseconds)",
  "checks_passed": $validation_passed,
  "checks_failed": $validation_failed,
  "project_id": "$PROJECT_ID"
}
VALIDATION_JSON_END
    
    exit 1
fi
VALIDATION_SCRIPT_END

chmod +x validation/validate-lab-01.sh

# Run validation
echo "Running Lab 01 validation..."
cd validation
./validate-lab-01.sh
cd ..
----

=== Manual Verification Steps
1. _Visual Inspection_: Check GCP Console for created resources
2. _Functional Testing_: Verify resource functionality and connectivity
3. _Security Review_: Confirm security controls are properly configured
4. _Documentation_: Ensure all configurations are documented

== Troubleshooting

=== Common Issues and Solutions

_Issue 1: Project Creation Failures_
[source,bash]
----
# Check billing account linkage
gcloud billing projects describe $PROJECT_ID

# Verify permissions
gcloud projects get-iam-policy $PROJECT_ID

# Check project quotas
gcloud compute project-info describe --project=$PROJECT_ID
----

_Issue 2: API Enablement Failures_
[source,bash]
----
# Check service account permissions
gcloud projects get-iam-policy $PROJECT_ID --flatten="bindings[].members" --filter="bindings.members:serviceAccount"

# Manual API enablement
gcloud services enable compute.googleapis.com --project=$PROJECT_ID
----

_Issue 3: Terraform State Issues_
[source,bash]
----
# Check state bucket access
gsutil ls gs://$TF_STATE_BUCKET

# Reinitialize if needed
terraform init -reconfigure

# Import existing resources if needed
terraform import google_project.workshop_projects["development"] ${PROJECT_ID}-dev
----

_Issue 4: Service Account Creation Failures_
[source,bash]
----
# Check IAM API enablement
gcloud services list --enabled --filter="name:iam.googleapis.com"

# Manual service account creation
gcloud iam service-accounts create workshop-dev-sa --display-name="Development Service Account" --project=${PROJECT_ID}-dev
----

=== Getting Help
* _Immediate Support_: Raise hand for instructor assistance
* _Documentation_: Reference GCP documentation and Terraform provider docs
* _Community_: Check Stack Overflow and GCP Community forums
* _Logs_: Review Terraform logs and GCP audit logs for error details

== Lab Completion Checklist

=== Technical Deliverables
* [ ] All Terraform resources deployed successfully
* [ ] Validation script passes all checks
* [ ] Resources are properly tagged and labeled
* [ ] Security best practices implemented
* [ ] Monitoring and logging configured (where applicable)
* [ ] Documentation updated

=== Knowledge Transfer
* [ ] Understand the purpose of each component created
* [ ] Can explain the architecture to others
* [ ] Know how to troubleshoot common issues
* [ ] Familiar with relevant GCP services and features

=== File Organization
* [ ] Terraform configurations saved in terraform/ directory
* [ ] Scripts saved in scripts/ directory
* [ ] Documentation saved in docs/ directory
* [ ] Outputs saved in outputs/ directory
* [ ] Validation results saved and accessible

== Output Artifacts

[source,bash]
----
# Save all lab outputs for future reference
mkdir -p outputs

# Terraform outputs
if [ -f terraform/terraform.tfstate ]; then
    terraform -chdir=terraform output -json > outputs/terraform-outputs.json
    echo "✓ Terraform outputs saved"
fi

# Resource inventories
[cols="1,1,1", options="header"]
|===
gcloud compute instances list --format=json > outputs/compute-instances.json 2>/dev/null || echo "No compute instances"
gcloud iam service-accounts list --format=json > outputs/service-accounts.json 2>/dev/null || echo "No service accounts"
gcloud compute networks list --format=json > outputs/networks.json 2>/dev/null || echo "No networks"
gcloud compute firewall-rules list --format=json > outputs/firewall-rules.json 2>/dev/null || echo "No firewall rules"
|===

# Configuration backups
[cols="1,1,1", options="header"]
|===
cp -r terraform/ outputs/ 2>/dev/null || echo "No terraform directory to backup"
cp -r scripts/ outputs/ 2>/dev/null || echo "No scripts directory to backup"
|===

# Create lab summary
cat > outputs/lab-01-summary.md << 'LAB_SUMMARY_END'
# Lab 01 Summary

## Completed: $(date)
## Project: $PROJECT_ID
## Participant: $LAB_USER

### Resources Created
- [List of resources created in this lab]

### Key Learnings
- [Key technical concepts learned]

### Next Steps
- Proceed to Lab 02
- Review outputs for integration with subsequent labs

### Files Generated
$(ls -la outputs/)
LAB_SUMMARY_END

echo "✓ Lab outputs and artifacts saved to outputs/ directory"
----

== Integration with Subsequent Labs

=== Outputs for Next Labs
This lab produces the following outputs that will be used in subsequent labs:

[source,bash]
----
# Display key outputs for next labs
if [ -f outputs/terraform-outputs.json ]; then
    echo "Key outputs from Lab 01:"
[cols="1,1,1", options="header"]
|===
    cat outputs/terraform-outputs.json | jq -r 'to_entries[] | "\(.key): \(.value.value)"'
|===
fi
----

=== Dependencies for Future Labs
* _Lab 02_: Will use [specific outputs] from this lab
* _Integration Points_: [How this lab integrates with overall architecture]

== Next Steps

=== Immediate Next Steps
1. _Review Created Resources_: Use GCP Console to explore the projects and resources created
2. _Understand Resource Relationships_: Study how projects, service accounts, and storage buckets are interconnected
3. _Prepare for Lab 02_: The Terraform environment and project structure created here will be used to set up advanced Terraform configurations

=== Preparation for Lab 02
* Ensure all validation checks pass
* Familiarize yourself with the created project structure
* Review Terraform state and outputs
* Understand the naming conventions established

=== Key Takeaways
* _Organizational Hierarchy_: Foundation for all subsequent infrastructure
* _Environment Separation_: Clear boundaries between dev, staging, and production
* _Service Accounts_: Identity and access foundation for workloads
* _Resource Naming_: Consistent naming enables easy management and automation

=== Preparation for Next Lab
1. _Ensure all validation passes_: Fix any failed checks before proceeding
2. _Review outputs_: Understand what was created and why
3. _Take a break_: Complex labs require mental breaks between sessions
4. _Ask questions_: Clarify any concepts before moving forward

'''

== Additional Resources

=== Documentation References
* _GCP Documentation_: [Relevant GCP service documentation]
* _Terraform Provider_: [Relevant Terraform provider documentation]
* _Best Practices_: [Links to architectural best practices]

=== Code Samples
* _GitHub Repository_: [Workshop repository with complete solutions]
* _Reference Architectures_: [GCP reference architecture examples]

'''

_Lab 01 Complete_ ✅

_Estimated Time for Completion_: 45 minutes
_Next Lab_: Lab 02 - [Next lab title]

_Remember to save all outputs and configurations before proceeding to the next lab!_

